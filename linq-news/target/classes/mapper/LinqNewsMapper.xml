<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.linq.news.mapper.LinqNewsMapper">
    <resultMap id="BaseResultMap" type="com.linq.news.domain.LinqNews">
        <!--@mbg.generated-->
        <!--@Table linq_news-->
        <id column="news_id" jdbcType="BIGINT" property="newsId"/>
        <result column="user_id"  jdbcType="BIGINT" property="userId"/>
        <result column="news_type_id" jdbcType="BIGINT" property="newsTypeId"/>
        <result column="news_title" jdbcType="LONGVARCHAR" property="newsTitle"/>
        <result column="news_content" jdbcType="LONGVARCHAR" property="newsContent"/>
        <result column="news_attr" jdbcType="CHAR" property="newsAttr"/>
        <result column="news_image" jdbcType="VARCHAR" property="newsImage"/>
        <result column="order_num" jdbcType="INTEGER" property="orderNum"/>
        <result column="is_public" jdbcType="CHAR" property="isPublic"/>
        <result column="thumbs" jdbcType="BIGINT" property="thumbs"/>
        <result column="visits" jdbcType="BIGINT" property="visits"/>
        <result column="comments" jdbcType="BIGINT" property="comments"/>
        <result column="collects" jdbcType="BIGINT" property="collects"/>
        <result column="status" jdbcType="CHAR" property="status"/>
        <result column="del_flag" jdbcType="CHAR" property="delFlag"/>
        <result column="create_by" jdbcType="VARCHAR" property="createBy"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="update_by" jdbcType="VARCHAR" property="updateBy"/>
        <result column="update_time" jdbcType="TIMESTAMP" property="updateTime"/>
        <result column="remark" jdbcType="VARCHAR" property="remark"/>
        <association property="newsType" javaType="com.linq.news.domain.LinqNewsType" column="news_type_id"
                     resultMap="newTypeResult"/>
    </resultMap>

    <!--新闻类型结果集合-->
    <resultMap id="newTypeResult" type="com.linq.news.domain.LinqNewsType">
        <id column="news_type_id" jdbcType="BIGINT" property="newsTypeId"/>
        <result column="news_type_name" jdbcType="VARCHAR" property="newsTypeName"/>
        <result column="status" jdbcType="CHAR" property="status"/>
    </resultMap>

    <sql id="Base_Column_List">
        <!--@mbg.generated-->
        news_id,user_id,news_type_id, news_title, news_content, news_attr, news_image, order_num,
        is_public, thumbs, visits, comments, collects, `status`, del_flag, create_by, create_time,
        update_by, update_time, remark
    </sql>
    <sql id="findNewsVo">
        select n.news_id,
               n.user_id,
               n.news_type_id,
               n.news_title,
               n.news_content,
               n.news_attr,
               n.news_image,
               n.order_num,
               n.is_public,
               n.thumbs,
               n.visits,
               n.comments,
               n.collects,
               n.`status`,
               n.del_flag,
               n.create_by,
               n.create_time,
               n.update_by,
               n.update_time,
               n.remark,
               nt.news_type_name,
               nt.status
        from linq_news n
                     left join linq_news_type nt on n.news_type_id = nt.news_type_id
    </sql>
    <!--
        /**
         * 查询新闻列表
         *
         * @param news 新闻
         *
         * @return 新闻集合
         */
        IPage<LinqNews> findPage(Page<LinqNews> linqNewsPage, @Param("news") LinqNews news);
    -->
    <select id="findPageAll" resultMap="BaseResultMap">
        <include refid="findNewsVo"/>
        where n.del_flag = '0'
        <if test="news.newsTypeId != null">
            and n.news_type_id = #{news.newsTypeId}
        </if>
        <if test="news.newsTitle != null  and news.newsTitle != ''">
            and n.news_title like '%${news.newsTitle}%'
        </if>
        <if test="news.newsAttr != null  and news.newsAttr != ''">
            and n.news_attr = #{news.newsAttr}
        </if>
        <if test="news.isPublic != null  and news.isPublic != ''">
            and n.is_public = #{news.isPublic}
        </if>
        <if test="news.status != null  and news.status != ''">
            and n.status = #{news.status}
        </if>
        <if test="news.beginTime != null and news.beginTime != ''">
            <!-- 开始时间检索 -->
            AND date_format(n.create_time, '%y%m%d') &gt;= date_format(#{news.beginTime}, '%y%m%d')
        </if>
        <if test="news.endTime != null and news.endTime != ''">
            <!-- 结束时间检索 -->
            AND date_format (n.create_time,'%y%m%d' ) &lt;= date_format( #{news.endTime},'%y%m%d' )
        </if>
        order by  n.order_num
    </select>
    <!--
        /**
         * 根据用户id查询新闻列表
         *
         * @param news 新闻
         *
         * @return 新闻集合
         */
        IPage<LinqNews> findPageByUserId(Page<LinqNews> linqNewsPage, @Param("news") LinqNews news);
    -->
    <select id="findPageByUserId" resultMap="BaseResultMap">
        <include refid="findNewsVo"/>
        left join sys_user su on n.user_id = su.user_id
            where n.del_flag = '0'
             and su.user_id = #{userId}
        <if test="news.newsTypeId != null">
            and n.news_type_id = #{news.newsTypeId}
        </if>
        <if test="news.newsTitle != null  and news.newsTitle != ''">
            and n.news_title like '%${news.newsTitle}%'
        </if>
        <if test="news.newsAttr != null  and news.newsAttr != ''">
            and n.news_attr = #{news.newsAttr}
        </if>
        <if test="news.isPublic != null  and news.isPublic != ''">
            and n.is_public = #{news.isPublic}
        </if>
        <if test="news.status != null  and news.status != ''">
            and n.status = #{news.status}
        </if>
        <if test="news.beginTime != null and news.beginTime != ''">
            <!-- 开始时间检索 -->
            AND date_format(n.create_time, '%y%m%d') &gt;= date_format(#{news.beginTime}, '%y%m%d')
        </if>
        <if test="news.endTime != null and news.endTime != ''">
            <!-- 结束时间检索 -->
            AND date_format (n.create_time,'%y%m%d' ) &lt;= date_format( #{news.endTime},'%y%m%d' )
        </if>
        order by  n.order_num
    </select>
</mapper>